function displayCalculation() {
  const container = document.getElementById('calcContainer');
  const reqData = getRequest();

  if (!reqData || !container) {
    container.innerHTML = '<p class="text-center">Tiada data. Sila buat request semula.</p>';
    return;
  }

  const user = reqData.user; // plain object dari localStorage
  const request = new PickupRequest(user, reqData.material, reqData.weightKg);
  const result = IncentiveCalculator.calculate(request);

  const totalRM = result.totalIncentive.toFixed(2);
  const totalPoints = result.points.toFixed(0);

  // --- Teks resit untuk preview / copy ---
  const receiptText = `
RESIT PICKUP ECORCYCLE

Nama          : ${user.name}
Emel          : ${user.email}
Telefon       : ${user.phone || '-'}
Jenis Barang  : ${request.material}
Berat         : ${request.weightKg} kg
Insentif      : RM ${totalRM}
Mata Ganjaran : ${totalPoints}

Terima kasih kerana menyokong kitar semula.
  `.trim();

  // --- Mesej WhatsApp ke OWNER (alamat sengaja kosong) ---
  const waMessage = `
EcoRecycle Pickup Request

Nama: ${user.name}
Emel: ${user.email}
Telefon: ${user.phone || '-'}
Jenis barang: ${request.material}
Berat: ${request.weightKg} kg
Insentif: RM ${totalRM}
Mata ganjaran: ${totalPoints}
Alamat: 
  `.trim(); // user akan isi alamat lepas "Alamat: "

  const waUrl = `https://wa.me/${ADMIN_WA_NUMBER}?text=${encodeURIComponent(waMessage)}`;

  container.innerHTML = `
    <div class="row justify-content-center">
      <div class="col-md-8">
        <h2 class="mb-4 text-center">Resit & WhatsApp</h2>

        <!-- Resit -->
        <div class="card shadow-sm mb-4" id="receiptCard">
          <div class="card-body">
            <h5 class="card-title">Resit Pickup</h5>
            <p><strong>Nama:</strong> ${user.name}</p>
            <p><strong>Emel:</strong> ${user.email}</p>
            <p><strong>Telefon:</strong> ${user.phone || '-'}</p>
            <p><strong>Jenis Barang:</strong> ${request.material}</p>
            <p><strong>Berat:</strong> ${request.weightKg} kg</p>
            <hr>
            <p class="fs-5"><strong>Insentif:</strong> RM ${totalRM}</p>
            <p class="fs-5"><strong>Mata Ganjaran:</strong> ${totalPoints} points</p>
          </div>
        </div>

        <!-- Teks resit (boleh copy / simpan) -->
        <div class="mb-3">
          <label class="form-label">Teks Resit (copy / simpan)</label>
          <textarea class="form-control" rows="7" readonly>${receiptText}</textarea>
        </div>

        <!-- Notifikasi Preview / WhatsApp -->
        <h4 class="mb-3">Mesej WhatsApp ke Owner</h4>
        <div class="mb-3">
          <label class="form-label">Preview mesej WhatsApp</label>
          <textarea class="form-control" rows="6" readonly>${waMessage}</textarea>
        </div>

        <p class="text-muted">
          Bila tekan butang di bawah, WhatsApp akan terbuka dengan mesej ini.
          Bahagian <strong>"Alamat:"</strong> masih kosong supaya pengguna boleh isi alamat sebelum tekan send.
        </p>

        <!-- Butang tindakan -->
        <a href="${waUrl}" target="_blank" class="btn btn-success w-100 mb-2">
          Buka WhatsApp &amp; Isi Alamat
        </a>

        <button class="btn btn-outline-secondary w-100 mb-2" onclick="downloadReceiptPdf()">
          Muat Turun Resit (PDF)
        </button>

        <a href="request.html" class="btn btn-outline-success w-100 mt-2">Buat Request Baru</a>
      </div>
    </div>
  `;
}
